import{a as P,j as s,g as Y,r as Q,n as R,M as D,o as T,t as Z,A as ee,q as se,v as le,b as te,X as re}from"./index-BLWlQvy-.js";import{u as ae,I as ie}from"./InlineMessage-CKJnmDKQ.js";const ne=()=>{const e=P.c(3);let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=s.jsx("div",{className:"p-4 border-b border-gray-200 bg-white/50",children:s.jsx("div",{className:"h-10 bg-gray-200 rounded-xl animate-pulse"})}),e[0]=r):r=e[0];let a;e[1]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsxs("div",{className:"lg:col-span-4 border-r border-gray-200 flex flex-col",children:[r,s.jsx("div",{className:"flex-1 overflow-y-auto",children:[...Array(8)].map(ce)})]}),e[1]=a):a=e[1];let n;return e[2]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx("section",{className:"relative -mt-10",children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-gray-200 rounded-2xl shadow-xl overflow-hidden",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 h-[calc(100vh-300px)] min-h-[600px]",children:[a,s.jsx("div",{className:"hidden lg:flex lg:col-span-8 flex-col",children:s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-300 animate-pulse",children:[s.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full mb-4"}),s.jsx("div",{className:"h-6 bg-gray-200 rounded w-32 mb-2"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-48"})]})})]})})})}),e[2]=n):n=e[2],n};function ce(e,r){return s.jsxs("div",{className:"p-4 flex items-start gap-3 border-b border-gray-100 bg-white/30 animate-pulse",style:{animationDelay:`${r*50}ms`},children:[s.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})]}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"})]})]},r)}const oe=()=>{const e=P.c(47),{user:r}=Y(),[a,n]=Q.useState(!1),{getAllMessages:I}=ae(),[t,G]=Q.useState(null),[c,X]=Q.useState("");r?.id;const F=r?.id??0;let j;e[0]===Symbol.for("react.memo_cache_sentinel")?(j=["messages"],e[0]=j):j=e[0];let y;e[1]!==I?(y={queryKey:j,queryFn:I,staleTime:0},e[1]=I,e[2]=y):y=e[2];const{data:i,isLoading:H}=R(y);let p;e[3]===Symbol.for("react.memo_cache_sentinel")?(p={queryKey:["freelancers"],queryFn:se,staleTime:3e5},e[3]=p):p=e[3];const{data:N,isLoading:J}=R(p);let v;e[4]===Symbol.for("react.memo_cache_sentinel")?(v={queryKey:["clients"],queryFn:le,staleTime:3e5},e[4]=v):v=e[4];const{data:w,isLoading:V}=R(v);let S;e[5]!==i?(S=Object.keys(i||{}),e[5]=i,e[6]=S):S=e[6];const U=S;let q;e:{if(!i||!N||!w){let b;e[7]===Symbol.for("react.memo_cache_sentinel")?(b=[],e[7]=b):b=e[7],q=b;break e}let l;if(e[8]!==w.clientsById||e[9]!==U||e[10]!==N.freelancersById||e[11]!==i){const b={...N.freelancersById,...w.clientsById};l=U.map(K=>{const L=b[K];if(!L)return null;const W=i[K].slice(-1)[0];return{id:K,userName:L.name,userAvatar:L.picture,isOnline:L.status==="online",lastMessage:W}}).filter(de),e[8]=w.clientsById,e[9]=U,e[10]=N.freelancersById,e[11]=i,e[12]=l}else l=e[12];q=l}const z=q;let C;e[13]!==z||e[14]!==c?(C=z.filter(l=>l.userName.toLowerCase().includes(c.toLowerCase())),e[13]=z,e[14]=c,e[15]=C):C=e[15];const _=C;if(J||V||H){let l;return e[16]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx(ne,{}),e[16]=l):l=e[16],l}let A;e[17]!==i||e[18]!==t?(A=t?i?.[t.id]??[]:[],e[17]=i,e[18]=t,e[19]=A):A=e[19];const O=A,B=`lg:col-span-4 border-r border-gray-200 flex flex-col ${a?"hidden lg:flex":"flex"}`;let M;e[20]===Symbol.for("react.memo_cache_sentinel")?(M=s.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e[20]=M):M=e[20];let k;e[21]===Symbol.for("react.memo_cache_sentinel")?(k=l=>X(l.target.value),e[21]=k):k=e[21];let o,d;e[22]!==c?(o=s.jsx("input",{type:"text",placeholder:"Поиск чатов...",value:c,onChange:k,className:"w-full h-10 pl-10 pr-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-sm"}),d=c&&s.jsx("button",{onClick:()=>X(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:s.jsx(re,{size:16})}),e[22]=c,e[23]=o,e[24]=d):(o=e[23],d=e[24]);let m;e[25]!==o||e[26]!==d?(m=s.jsx("div",{className:"p-4 border-b border-gray-200 bg-white/50",children:s.jsxs("div",{className:"relative",children:[M,o,d]})}),e[25]=o,e[26]=d,e[27]=m):m=e[27];let x;e[28]!==_||e[29]!==t?.id?(x=_.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500 px-4",children:[s.jsx(D,{size:48,className:"mb-3 opacity-30"}),s.jsx("p",{className:"text-sm text-center",children:"Чаты не найдены"})]}):_.map(l=>s.jsxs("button",{onClick:()=>{G(l),n(!0)},className:`w-full p-4 flex items-start gap-3 hover:bg-indigo-50/50 transition-colors border-b border-gray-100 ${t?.id===l.id?"bg-indigo-50/70":"bg-white/30"}`,children:[l.userAvatar?s.jsx(s.Fragment,{children:s.jsxs(T,{to:`/profile/${l.id}`,children:[s.jsx("img",{src:l.userAvatar?.medium,alt:l.userName,className:"w-12 h-12 rounded-full object-cover"}),l.isOnline&&s.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"})]})}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-4xl font-bold",children:l.userName?.charAt(0).toUpperCase()||"U"}),s.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("h3",{className:"font-semibold text-gray-900 truncate text-sm",children:l.userName}),s.jsx("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:l.lastMessage.timestamp})]}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("p",{className:"text-sm text-gray-600 truncate pr-2",children:l.lastMessage.text})})]})]},l.id)),e[28]=_,e[29]=t?.id,e[30]=x):x=e[30];let f;e[31]!==x?(f=s.jsx("div",{className:"flex-1 overflow-y-auto",children:x}),e[31]=x,e[32]=f):f=e[32];let u;e[33]!==m||e[34]!==f||e[35]!==B?(u=s.jsxs("div",{className:B,children:[m,f]}),e[33]=m,e[34]=f,e[35]=B,e[36]=u):u=e[36];const E=`lg:col-span-8 flex flex-col ${a?"flex":"hidden lg:flex"}`;let h;e[37]!==O||e[38]!==F||e[39]!==t?(h=t?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white/50 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>n(!1),className:"lg:hidden text-gray-600 hover:text-gray-900",children:s.jsx(Z,{size:20})}),t.userAvatar?s.jsx(s.Fragment,{children:s.jsxs(T,{to:`/profile/${t.id}`,children:[s.jsx("img",{src:t.userAvatar?.medium,alt:t.userName,className:"w-10 h-10 rounded-full object-cover"}),t.isOnline&&s.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"})]})}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-4xl font-bold",children:t.userName?.charAt(0).toUpperCase()||"U"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:t.userName}),s.jsx("p",{className:"text-xs text-gray-500",children:t.isOnline?"В сети":"Не в сети"})]})]}),s.jsxs(T,{to:`/messages/${t.id}`,className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-gray-600 hover:text-gray-900",children:"Открыть чат"}),s.jsx(ee,{size:15})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-gray-50/30 to-white/30",children:O.map(l=>s.jsx(ie,{message:l,currentUser:{id:Number(t.id),name:t.userName,picture:t.userAvatar},ownUserId:F},l.id))})]}):s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-500",children:[s.jsx(D,{size:64,className:"mb-4 opacity-20"}),s.jsx("p",{className:"text-lg font-medium",children:"Выберите чат"}),s.jsx("p",{className:"text-sm",children:"Выберите диалог из списка слева"})]}),e[37]=O,e[38]=F,e[39]=t,e[40]=h):h=e[40];let g;e[41]!==E||e[42]!==h?(g=s.jsx("div",{className:E,children:h}),e[41]=E,e[42]=h,e[43]=g):g=e[43];let $;return e[44]!==u||e[45]!==g?($=s.jsx("section",{className:"relative -mt-10",children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsx("div",{className:"bg-white/70 backdrop-blur-sm border border-gray-200 rounded-2xl shadow-xl overflow-hidden",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 h-[calc(100vh-300px)] min-h-[600px]",children:[u,g]})})})}),e[44]=u,e[45]=g,e[46]=$):$=e[46],$};function de(e){return e!==null}const fe=()=>{const e=P.c(2);let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=s.jsxs("div",{className:"absolute inset-0 h-64 pointer-events-none",children:[s.jsx("div",{className:"absolute -top-24 -right-24 w-96 h-96 bg-indigo-200 rounded-full blur-3xl opacity-40"}),s.jsx("div",{className:"absolute -bottom-32 -left-32 w-[28rem] h-[28rem] bg-purple-200 rounded-full blur-3xl opacity-40"})]}),e[0]=r):r=e[0];let a;return e[1]===Symbol.for("react.memo_cache_sentinel")?(a=s.jsxs("div",{className:"min-h-screen pb-10",children:[s.jsxs("section",{className:"relative",children:[r,s.jsx("div",{className:"relative pt-20 pb-15",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-full border border-indigo-100 text-sm font-medium text-indigo-600 mb-4",children:[s.jsx(D,{size:16}),"Сообщения"]}),s.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-4",children:"Чаты с исполнителями и заказчиками"}),s.jsx("p",{className:"text-lg text-gray-600",children:"Обсудите детали проекта напрямую с фрилансерами, уточните детали у заказчиков"})]})})]}),s.jsx(oe,{})]}),e[1]=a):a=e[1],a};export{fe as default};
